{"componentChunkName":"component---src-templates-tag-tsx","path":"/tags/svg","result":{"pageContext":{"posts":[{"excerpt":"chromium 手下留情，別廢掉 SVG SMIL 呀！","html":"<p style=\"text-align:center;\">\n  <img src=\"/image/rick-animate-additive.svg\" alt=\"animate values attribute demo\">\n</p>\n<p>chromium 手下留情，別廢掉 SVG SMIL 呀！</p>\n<!-- more -->\n<h2 id=\"前言\" style=\"position:relative;\"><a href=\"#%E5%89%8D%E8%A8%80\" aria-label=\"前言 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>前言</h2>\n<p>前幾個禮拜看到 jotai 的作者推文提到 jotai 的 logo 用了 <code class=\"language-text\">animateTransform</code> 來製作動畫（不知道 jotai 的可以看這篇 - <a href=\"https://blog.techbridge.cc/2021/03/01/jotai-intro/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Jōtai 介紹</a>）：</p>\n<blockquote class=\"twitter-tweet\"><p lang=\"en\" dir=\"ltr\">If you are not familiar with SVG animation, check this out. jotai <a href=\"https://t.co/Zadia8oug7\">https://t.co/Zadia8oug7</a> 👻 logo is using &lt;animateTransform&gt;. <a href=\"https://t.co/vll2SU5f16\">pic.twitter.com/vll2SU5f16</a></p>&mdash; Daishi Kato (@dai_shi) <a href=\"https://twitter.com/dai_shi/status/1401516470882893827?ref_src=twsrc%5Etfw\">June 6, 2021</a></blockquote> <script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script>\n<img src=\"https://raw.githubusercontent.com/pmndrs/jotai/master/img/title.svg\" alt=\"jotai logo\">\n<p>(要等一會兒才會出現...如果沒有，可能是 cache 問題，可以點<a href=\"https://raw.githubusercontent.com/pmndrs/jotai/master/img/title.svg\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">此</a>開新頁查看。)</p>\n<p>svg 檔案會動不稀奇，像是<a href=\"https://blog.techbridge.cc/2019/11/06/svg-animation-in-10mins/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">十分鐘、五步驟，SVG 動起來！</a>中介紹的，透過第三方套件可以很容易達成，或是用一些繪圖、動畫工具也行，例如：<a href=\"https://app.svgator.com/#/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">SVGator</a>，不過這些都得搭配 JavaScript，然而簡單的動畫只要利用 SVG 支援的語法即可達成！</p>\n<p>今天就一起來了解一下，怎麼在不靠其它套件的狀況下，單純的製作 SVG 動畫。</p>\n<h2 id=\"svg-animation-with-smil\" style=\"position:relative;\"><a href=\"#svg-animation-with-smil\" aria-label=\"svg animation with smil permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SVG animation with SMIL</h2>\n<p>能讓 SVG 不靠 JavaScript 與 CSS 就能動起來是因為使用了 <a href=\"https://www.w3.org/TR/REC-smil\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">SMIL（Synchronized Multimedia Integration Language）</a>，音同 smile，是 W3C 的標準之一，旨在以 XML 格式提供多媒體的交互表現（白話點其實就是動畫），是 Web 上動畫的開路先鋒，啟發了 Web animation 與 CSS animation。SVG 與 SMIL 的開發團隊合作，讓 SVG 能利用 SMIL 達到如下效果：</p>\n<ul>\n<li>動畫化元素的數值屬性（x, y 值等等)</li>\n<li>動畫化元素的 transform 屬性（平移、旋轉）</li>\n<li>動畫化元素顏色</li>\n<li>軌跡路線移動動畫，類似於 <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/offset-path\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">CSS 中的 <code class=\"language-text\">offset-path</code></a></li>\n</ul>\n<p>光是這些特性就夠我們組合出很多種的動畫了，還不需要 JavaScript 與 CSS 的輔助。</p>\n<p>使用方法也不難，只要在 SVG 元素內置入以下四種元素即可操作動畫：</p>\n<ol>\n<li><code class=\"language-text\">&lt;set></code></li>\n<li><code class=\"language-text\">&lt;animate></code></li>\n<li><code class=\"language-text\">&lt;animateTransform></code></li>\n<li><code class=\"language-text\">&lt;animateMotion></code></li>\n</ol>\n<p>接著我們針對這四種元素一一介紹。</p>\n<p>不過在開始前，有個小插曲值得一提。</p>\n<p>SMIL 這個標準其實在 2015 年的時候差點被廢除，因為使用人數少，支援的主流瀏覽器也不多，所以 chromium 工程師本來想要 deprecate 它，順勢推廣 Web animation 與 CSS animation，但在消息公布後，收到了社群很多人的回饋，最終決定暫停廢除計劃，也因此我們到現在都還能使用 SVG SMIL animation，<a href=\"https://caniuse.com/svg-smil\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">主流瀏覽器也都支援</a>了，使用者也從 0.04% 上升到 <a href=\"https://www.chromestatus.com/metrics/feature/timeline/popularity/501\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">1% 以上</a>。</p>\n<p>有興趣的讀者可以回追一下<a href=\"https://groups.google.com/a/chromium.org/g/blink-dev/c/5o0yiO440LM\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">這串討論</a>。</p>\n<h2 id=\"svg-animation-element-介紹與示範\" style=\"position:relative;\"><a href=\"#svg-animation-element-%E4%BB%8B%E7%B4%B9%E8%88%87%E7%A4%BA%E7%AF%84\" aria-label=\"svg animation element 介紹與示範 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SVG animation element 介紹與示範</h2>\n<h3 id=\"set\" style=\"position:relative;\"><a href=\"#set\" aria-label=\"set permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>&#x3C;set></h3>\n<p>利用 <code class=\"language-text\">&lt;set></code> 元素你能夠指定在一段時間後，改變 svg 的一個屬性，例如 2 秒後將 Rick 的眼睛變成往下看：</p>\n<p style=\"text-align:center;\">\n  <img src=\"/image/rick-set.svg\" alt=\"set element demo\">\n</p>\n<p>疑？你說他本來就是往下看的？</p>\n<p>那是因為 <code class=\"language-text\">set</code> 不會重複執行，從你載入這篇文章到看到這個位置為止，相信已經超過 2 秒，所以已經是執行後的結果，建議你按右鍵 -> \"在新分頁中開啟圖片\"，實際體驗一下，再不然看看下面的 gif 也行：</p>\n<p style=\"text-align:center;\">\n  <img src=\"/image/rick-svg-animation-set.gif\" alt=\"set element demo\">\n</p>\n<p>相關程式碼如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>circle</span> <span class=\"token attr-name\">cx</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>56.7573<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">cy</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>92.8179<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">r</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>2<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">fill</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>black<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">stroke</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>black<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">stroke-width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>set</span> <span class=\"token attr-name\">attributeName</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>cy<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">to</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>105.7318<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">begin</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>2s<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>circle</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>將 <code class=\"language-text\">&lt;set></code> 元素放在你想要套用效果的 svg shape 內即可。</p>\n<p><code class=\"language-text\">attributeName</code> 指定你要更動的屬性；<code class=\"language-text\">to</code> 代表變化值；<code class=\"language-text\">begin</code> 代表從載入後的什麼時候開始執行。</p>\n<p>除了 <code class=\"language-text\">attributeName</code> 外，有另一個參數叫 <code class=\"language-text\">attributeType</code>，用來告訴瀏覽器你要動畫化的屬性值是屬於 <code class=\"language-text\">XML</code>（e.g. <code class=\"language-text\">cy</code>），還是 <code class=\"language-text\">CSS</code>（e.g. <code class=\"language-text\">opacity</code>），不指定的話，瀏覽器會自己猜。不過呢，這個參數也已經 <a href=\"https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/attributeType\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">deprecated</a> 了，所以實際上我們不再需要它。</p>\n<h3 id=\"animate\" style=\"position:relative;\"><a href=\"#animate\" aria-label=\"animate permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>&#x3C;animate></h3>\n<p><code class=\"language-text\">&lt;animate></code> 元素讓你能針對單一屬性變化套用動畫補間效果。用法一樣是放在你想要套用效果的 svg shape 內：</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>circle</span> <span class=\"token attr-name\">cx</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>56.7573<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">cy</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>92.8179<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">r</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>2<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">fill</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>black<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">stroke</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>black<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">stroke-width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>animate</span>\n      <span class=\"token attr-name\">attributeName</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>cx<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">from</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>56.7573<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">to</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>64.7573<span class=\"token punctuation\">\"</span></span>\n      <span class=\"token attr-name\">dur</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>2s<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">repeatCount</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>indefinite<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>circle</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>與 <code class=\"language-text\">&lt;set></code> 相比，多了 <code class=\"language-text\">from</code> 屬性來指定要從哪個值開始做變化，<code class=\"language-text\">dur</code> 指定動畫的執行時間，<code class=\"language-text\">repeatCount</code> 指定要重複幾次，這邊我們設定 <code class=\"language-text\">indefinite</code> 讓他無限重播（若看不到效果請以分頁開新圖片）：</p>\n<p style=\"text-align:center;\">\n  <img src=\"/image/rick-animate.svg\" alt=\"animate element demo\">\n</p>\n<p>利用 <code class=\"language-text\">animate</code>，讓 Rick 的眼睛向右看。</p>\n<p>也可以用來改變顏色：</p>\n<p style=\"text-align:center;\">\n  <img src=\"/image/rick-animate-color.svg\" alt=\"animate element color demo\">\n</p>\n<p>也因為可以用來改變顏色，所以本來有個 <code class=\"language-text\">&lt;animateColor></code> 元素就被取代掉了，現在<a href=\"https://developer.mozilla.org/en-US/docs/Web/SVG/Element/animatecolor\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">已經 deprecated 了</a>。</p>\n<h3 id=\"animatetransform\" style=\"position:relative;\"><a href=\"#animatetransform\" aria-label=\"animatetransform permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>&#x3C;animateTransform></h3>\n<p><code class=\"language-text\">&lt;animateTransform></code> 可以用來控制 <code class=\"language-text\">transform</code> 屬性，用 <code class=\"language-text\">animate</code> 無法做到。跟 CSS 中的 transform 一樣，可以控制 <strong>translation</strong>、<strong>scaling</strong>、<strong>rotation</strong> 跟 <strong>skewing</strong>。</p>\n<p style=\"text-align:center;\">\n  <img src=\"/image/rick-animate-transform.svg\" alt=\"animateTransform element demo\">\n</p>\n<p>可以讓 Rick 頭轉起來，看起來頗ㄎㄧㄤ LOL\n（註：經實測，animateTransform 在手機上似乎不支援，請用桌面版瀏覽器查看此範例）</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>animateTransform</span> <span class=\"token attr-name\">attributeName</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>transform<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>rotate<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">from</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0 0 0<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">to</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>360 0 0<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">begin</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0s<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">dur</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>10s<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">repeatCount</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>indefinite<span class=\"token punctuation\">\"</span></span>\n<span class=\"token punctuation\">/></span></span></code></pre></div>\n<p>如上面所述，要控制 <code class=\"language-text\">transform</code> 屬性，所以 <code class=\"language-text\">attributeName=\"transform\"</code>，接著 <code class=\"language-text\">type</code> 參數就看你想要 transform 的類型是什麼，<code class=\"language-text\">rotate</code>、<code class=\"language-text\">scale</code> 都可以。其餘 <code class=\"language-text\">from</code>、<code class=\"language-text\">to</code>、<code class=\"language-text\">begin</code>、<code class=\"language-text\">dur</code>等參數都與之前的相同，用來指定動畫的起始終點值、時間長度與執行次數。</p>\n<h3 id=\"animatemotion\" style=\"position:relative;\"><a href=\"#animatemotion\" aria-label=\"animatemotion permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>&#x3C;animateMotion></h3>\n<p>最後一個元素，<code class=\"language-text\">animateMotion</code>，讓 svg 沿著軌跡 <code class=\"language-text\">path</code> 移動（若看不到效果請以分頁開新圖片）：</p>\n<p style=\"text-align:center;\">\n  <img src=\"/image/rick-animate-motion.svg\" alt=\"animateMotion element demo\">\n</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token comment\">&lt;!--軌跡--></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>path</span> <span class=\"token attr-name\">d</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>M10,50 q60,50 100,0 q60,-50 100,0<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">stroke</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>black<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">stroke-width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>2<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>g</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token comment\">&lt;!-- Rick 飛船 svg--></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>animateMotion</span>\n    <span class=\"token attr-name\">path</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>M10,50 q60,50 100,0 q60,-50 100,0<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token attr-name\">begin</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0s<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">dur</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>10s<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">repeatCount</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>indefinite<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>g</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>上述程式碼內的 <code class=\"language-text\">&lt;path></code> 只是為了讓大家看清楚路徑與實際動畫的軌跡無關，實際使用上只要給定 <code class=\"language-text\">animateMotion</code> 一條 <code class=\"language-text\">path</code> 屬性值，包含 <code class=\"language-text\">animateMotion</code> 元素的 svg 就會跟著該路徑移動。</p>\n<p>其他屬性值跟其他元素雷同，不過 <code class=\"language-text\">animateMotion</code> 還有個特別的屬性值 <code class=\"language-text\">rotate</code>，用來指定是否要隨著路徑移動的同時，選轉綁定的 svg 物件，可以設定為 <code class=\"language-text\">auto</code> 或 <code class=\"language-text\">auto-reverse</code>：</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>animateMotion</span>\n  <span class=\"token attr-name\">path</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>M10,50 q60,50 100,0 q60,-50 100,0<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">begin</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0s<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">dur</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>10s<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">repeatCount</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>indefinite<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">rotate</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>auto<span class=\"token punctuation\">\"</span></span>\n<span class=\"token punctuation\">/></span></span></code></pre></div>\n<p style=\"text-align:center;\">\n  <img src=\"/image/rick-animate-motion-rotate.svg\" alt=\"animateMotion element demo\">\n</p>\n<p>此外，除了給定 <code class=\"language-text\">path</code> 屬性值外，其實也能夠利用既有的 <code class=\"language-text\">&lt;path></code> 來當作 <code class=\"language-text\">animateMotion</code> 的路徑，但是得透過 <code class=\"language-text\">mpath</code> 這個 sub-element：</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token comment\">&lt;!--軌跡--></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>path</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>path1<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">d</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>M10,50 q60,50 100,0 q60,-50 100,0<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">stroke</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>black<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">stroke-width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>2<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>g</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token comment\">&lt;!-- Rick 飛船 svg--></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>animateMotion</span> <span class=\"token attr-name\">begin</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0s<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">dur</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>10s<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">repeatCount</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>indefinite<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mpath</span> <span class=\"token attr-name\"><span class=\"token namespace\">xlink:</span>href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>#path1<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>animateMotion</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>g</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>要注意的是，若要使用 <code class=\"language-text\">xlink:href</code> 來指定連接的 svg 元素，在你的 <code class=\"language-text\">&lt;svg></code> tag 上得先記得宣告 <code class=\"language-text\">xmlns:xlink=\"http://www.w3.org/1999/xlink\"</code>。</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>svg</span> <span class=\"token attr-name\">width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>300<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>200<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">viewBox</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0 0 500 300<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">fill</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>none<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.w3.org/2000/svg<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>xlink</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.w3.org/1999/xlink<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>svg</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>有了 <code class=\"language-text\">xlink:href</code>，我們也就不用像之前範例中所做的一樣，一定得把 <code class=\"language-text\">animate</code> 元素放在要綁定的 svg shape 內，可以透過 <code class=\"language-text\">id</code> 與 <code class=\"language-text\">xlink:href</code> 來連結，例如第一個 <code class=\"language-text\">&lt;set></code> 的範例可改為：</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>circle</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>eyes<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">cx</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>56.7573<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">cy</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>92.8179<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">r</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>2<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">fill</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>black<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">stroke</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>black<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">stroke-width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>circle</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>set</span> <span class=\"token attr-name\"><span class=\"token namespace\">xlink:</span>href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>#eyes<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">attributeName</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>cy<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">to</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>105.7318<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">begin</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>2s<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></code></pre></div>\n<p>至此我們介紹完了四種 SVG animation element，除了個別拿來使用外，這些元素是能夠組合在一起使用的，就只要個別把對應的 animate element 套用在想要的 svg shape 上即可，舉例來說，可以讓 Rick 旋轉的同時，髮色改變、眼睛轉動（可右鍵看 svg 原始碼，在裡面可以找到多個 animate element）：</p>\n<p style=\"text-align:center;\">\n  <img src=\"/image/rick-animate-combine.svg\" alt=\"combine animate elements demo\">\n</p>\n<p>（註：經實測，animateTransform 在手機上似乎不支援，請用桌面版瀏覽器查看此範例）</p>\n<h2 id=\"svg-smil-animation-重點參數介紹\" style=\"position:relative;\"><a href=\"#svg-smil-animation-%E9%87%8D%E9%BB%9E%E5%8F%83%E6%95%B8%E4%BB%8B%E7%B4%B9\" aria-label=\"svg smil animation 重點參數介紹 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SVG SMIL animation 重點參數介紹</h2>\n<p>在上面的 Demo 裡面，我們可以發現 SVG animate element 有很多參數可以使用，範例中只用到了一部分，但其實這些參數能設定的值都有不少變化，想要清楚知道每一個參數的用途與範例，推薦參考這篇文章 - <a href=\"https://css-tricks.com/guide-svg-animations-smil/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">A Guide to SVG Animations (SMIL)</a>，不介意簡體中文的話，可以看<a href=\"https://www.zhangxinxu.com/wordpress/2014/08/so-powerful-svg-smil-animation/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">這篇</a>，都寫得非常好非常詳細。</p>\n<p>在這個章節我會重點介紹一些我覺得比較有趣及實用的參數。</p>\n<h3 id=\"from-to-by-values\" style=\"position:relative;\"><a href=\"#from-to-by-values\" aria-label=\"from to by values permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>from, to, by, values</h3>\n<p><code class=\"language-text\">from</code> 跟 <code class=\"language-text\">to</code> 在前面的範例中都有看到，功能也如同字面般好懂，就是指定動畫變化的移動區間，從（<code class=\"language-text\">from</code>）某個值變化到（<code class=\"language-text\">to</code>）另個值；而 <code class=\"language-text\">by</code> 則是代表位移量，相對於明確告知要變動到哪個值，我們可以用 <code class=\"language-text\">by</code> 告訴 svg 要變動”多少的量“，例如前面 <code class=\"language-text\">animateTransform</code> 的例子，我們可以改為：</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>animateTransform</span> <span class=\"token attr-name\">attributeName</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>transform<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>rotate<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">from</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0 0 0<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">by</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>360<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">begin</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0s<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">dur</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>10s<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">repeatCount</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>indefinite<span class=\"token punctuation\">\"</span></span>\n<span class=\"token punctuation\">/></span></span></code></pre></div>\n<p>看到這邊你應該會注意到，<code class=\"language-text\">by</code> 跟 <code class=\"language-text\">to</code> 功能上有點重複，所以彼此之間有優先權，如果同時有指定 <code class=\"language-text\">to</code> 與 <code class=\"language-text\">by</code>，則只會套用到 <code class=\"language-text\">to</code> 的值。</p>\n<p>再來看看 <code class=\"language-text\">values</code>，這個剛剛的範例都沒出現，它的功用是來補足 <code class=\"language-text\">from</code>、<code class=\"language-text\">to</code>、<code class=\"language-text\">by</code> 的不足。不足的點在於， <code class=\"language-text\">from</code>、<code class=\"language-text\">to</code>、<code class=\"language-text\">by</code> 只能指定兩個值之間的變化，從 a 變化到 b，而 <code class=\"language-text\">values</code> 可以給定多個值，用分號 <code class=\"language-text\">;</code> 隔開，就能有 a -> b -> c -> b -> a 這樣的變化，舉個例子：</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>animateTransform</span> <span class=\"token attr-name\">attributeName</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>transform<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>translate<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">values</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>20;120;20<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">begin</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0s<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">dur</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>3s<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">repeatCount</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>indefinite<span class=\"token punctuation\">\"</span></span>\n<span class=\"token punctuation\">/></span></span></code></pre></div>\n<p style=\"text-align:center;\">\n  <img src=\"/image/rick-animate-values.svg\" alt=\"animate values attribute demo\">\n</p>\n<h3 id=\"begin-end\" style=\"position:relative;\"><a href=\"#begin-end\" aria-label=\"begin end permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>begin, end</h3>\n<p><code class=\"language-text\">begin</code> 跟 <code class=\"language-text\">end</code> 分別用來控制何時開始執行動畫，何時停止動畫，在上面的例子中我們都只用到時間，像是 <code class=\"language-text\">begin=\"2s\"</code>，但其實這兩個參數能給的值有非常多的種類，而且能向 <code class=\"language-text\">values</code> 一樣賦予多個值，只要用 <code class=\"language-text\">;</code> 隔開即可：</p>\n<p><code class=\"language-text\">begin = &lt;offset-value> | &lt;syncbase-value> | &lt;event-value> | &lt;repeat-value> | &lt;accessKey-value> | &lt;wallclock-sync-value></code></p>\n<p>每種類型的詳細介紹，我推薦直接看 <a href=\"https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/begin\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">MDN</a>，或是對岸網友的<a href=\"https://www.zhangxinxu.com/wordpress/2014/08/so-powerful-svg-smil-animation/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">整理</a>，這邊我只說明幾個我覺得比較實用的。</p>\n<p>首先是 <code class=\"language-text\">&lt;syncbase-value></code>。</p>\n<p>從字面有點難懂，主要是用其他 animate 元素的 begin/end 值再做加減，舉個例子就比較好懂：</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token comment\">&lt;!-- Rick head --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>g</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>animateTransform</span> <span class=\"token attr-name\">attributeName</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>transform<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>scale<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token attr-name\">values</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>1;1.2;1<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token attr-name\">begin</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>ship.end<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">dur</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>3s<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token attr-name\">repeatCount</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>indefinite<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>g</span><span class=\"token punctuation\">></span></span>\n<span class=\"token comment\">&lt;!-- spaceship --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>g</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>animateTransform</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>ship<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">attributeName</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>transform<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>translate<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token attr-name\">values</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>20;120;20<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token attr-name\">begin</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0s<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">dur</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>3s<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>g</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>這次範例中的 svg 內有兩個 animate 元素，給定針對太空船做動畫的元素一個 id 值 <code class=\"language-text\">ship</code>，然後在 Rick 的動畫元素上利用 <code class=\"language-text\">begin=\"ship.end\"</code>，就可以讓 Rick 頭的動畫等到太空船的動畫做完後再啟動，效果如下（這需要麻煩讀者用新分頁開啟圖片來觀看）：</p>\n<p style=\"text-align:center;\">\n  <img src=\"/image/rick-animate-begin-syncbase.svg\" alt=\"animate begin syncbase demo\">\n</p>\n<p>另一個我覺得實用的值是 <code class=\"language-text\">event-value</code>，看名字就知道，是可以依照 <code class=\"language-text\">event</code> 來啟動或終結動畫，用法與 <code class=\"language-text\">syncbase-value</code> 雷同，給定元素 id，然後根據該元素觸發的事件讓動畫 <code class=\"language-text\">begin</code> 或是 <code class=\"language-text\">end</code>。幾乎所有 DOM element 支援的 event 都能使用，<a href=\"https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/begin\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">MDN</a> 有列出所有可用事件。</p>\n<p>一樣舉個例子，點擊 Rick 就能讓太空船移動（礙於 blog 格式，這範例得放在 codepen 上）：</p>\n<p class=\"codepen\" data-height=\"182\" data-theme-id=\"29194\" data-default-tab=\"result\" data-user=\"arvin0731\" data-slug-hash=\"BaWEJpm\" style=\"height: 182px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;\" data-pen-title=\"SVG SMIL Demo - rick and spaceship\">\n  <span>See the Pen <a href=\"https://codepen.io/arvin0731/pen/BaWEJpm\">\n  SVG SMIL Demo - rick and spaceship</a> by Arvin (<a href=\"https://codepen.io/arvin0731\">@arvin0731</a>)\n  on <a href=\"https://codepen.io\">CodePen</a>.</span>\n</p>\n<script async src=\"https://cpwebassets.codepen.io/assets/embed/ei.js\"></script>\n<p>程式碼如下，<code class=\"language-text\">rickhead.click</code>（[元素 id].[event]）：</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>g</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>rickhead<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span> <span class=\"token comment\">&lt;!--// 略 --></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>g</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>g</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>animateTransform</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>ship<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">attributeName</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>transform<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>translate<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token attr-name\">values</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>20;120;20<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token attr-name\">begin</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>rickhead.click<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">dur</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>3s<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>g</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>最後是 <code class=\"language-text\">indefinite</code>，如果你的 <code class=\"language-text\">begin</code> 值為 <code class=\"language-text\">indefinite</code>，代表無限等待，這時就需要透過 <code class=\"language-text\">[animate 元素].beginElement()</code> 來觸發，或是用 <code class=\"language-text\">&lt;a></code> tag 的 <code class=\"language-text\">xlink:href=\"#[animate 元素 id]\"</code> 來啟動。</p>\n<p class=\"codepen\" data-height=\"189\" data-theme-id=\"29194\" data-default-tab=\"html,result\" data-user=\"arvin0731\" data-slug-hash=\"PopgERE\" style=\"height: 189px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;\" data-pen-title=\"SVG SMIL Demo - rick and spaceship - event trigger\">\n  <span>See the Pen <a href=\"https://codepen.io/arvin0731/pen/PopgERE\">\n  SVG SMIL Demo - rick and spaceship - event trigger</a> by Arvin (<a href=\"https://codepen.io/arvin0731\">@arvin0731</a>)\n  on <a href=\"https://codepen.io\">CodePen</a>.</span>\n</p>\n<script async src=\"https://cpwebassets.codepen.io/assets/embed/ei.js\"></script>\n<h3 id=\"calcmode-keytimes-keysplines\" style=\"position:relative;\"><a href=\"#calcmode-keytimes-keysplines\" aria-label=\"calcmode keytimes keysplines permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>calcMode, keyTimes, keySplines</h3>\n<p>這三個參數主要讓你能夠更細微的調整動畫的速度變化。</p>\n<p><code class=\"language-text\">calcMode</code> 有四種模式：<code class=\"language-text\">discrete</code>、<code class=\"language-text\">linear</code>、<code class=\"language-text\">paced</code>、<code class=\"language-text\">spline</code>。</p>\n<p><strong>discrete</strong> 顧名思義就是離散的，<code class=\"language-text\">from</code> 值跳到 <code class=\"language-text\">to</code> 值不做補間; <strong>linear</strong> 跟 <strong>paced</strong> 我覺得效果雷同，都是讓讓補間動畫的速度維持一致（linear）與平均（paced）; <code class=\"language-text\">spline</code> 則是使用貝式曲線，需要搭配 <code class=\"language-text\">keyTimes</code> 與 <code class=\"language-text\">keySplines</code> 來使用。</p>\n<p><code class=\"language-text\">keyTimes</code> 就是關鍵影格，跟前面提過的 <code class=\"language-text\">values</code> 一樣，可以接受多個以分號區隔的值，定義動畫的關鍵時間點，搭配不同的 <code class=\"language-text\">calcMode</code> 就能在不同的時間點有不同的速度效果。</p>\n<p><code class=\"language-text\">keySpline</code> 是當你 <code class=\"language-text\">calcMode</code> 設定為 <code class=\"language-text\">spline</code> 時，用來定義貝式曲線的四個控制點的。</p>\n<p>這邊直接引用對岸網友精緻的 Demo 頁面給大家參考，用看的會比較清楚好理解：<a href=\"http://www.zhangxinxu.com/study/201408/svg-animation-calcmode.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">calcMode、keyTimes、keySplines 屬性 DEMO</a>。該作者對於 <code class=\"language-text\">keySpline</code> 的值也有<a href=\"https://www.zhangxinxu.com/wordpress/2014/08/so-powerful-svg-smil-animation/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">畫圖說明</a>，很好懂，有興趣研究的話值得一看。</p>\n<h3 id=\"additive\" style=\"position:relative;\"><a href=\"#additive\" aria-label=\"additive permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>additive</h3>\n<p>看到最後，不知道你會不會有個疑問：如果我想針對同的 SVG shape 的同個屬性做多個連續變化時該怎麼辦？</p>\n<p>例如：透過 <code class=\"language-text\">animateTransform</code> 先將圖案放大再位移。</p>\n<p>這時就要靠 <code class=\"language-text\">additive</code> 這個參數出馬了，<code class=\"language-text\">additive</code> 參數告知 SVG 是否要累加（<code class=\"language-text\">sum</code>）動畫效果，或是取代（<code class=\"language-text\">replace</code>），預設是 <code class=\"language-text\">replace</code>。</p>\n<p>例子：</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>animateTransform</span> <span class=\"token attr-name\">attributeName</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>transform<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>scale<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">by</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>1.1<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">begin</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0s<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">dur</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>5s<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">repeatCount</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>indefinite<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">additive</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>sum<span class=\"token punctuation\">\"</span></span>\n<span class=\"token punctuation\">/></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>animateTransform</span> <span class=\"token attr-name\">attributeName</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>transform<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>rotate<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">from</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0 0 0<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">to</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>360 0 0<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">begin</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0s<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">dur</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>5s<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">repeatCount</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>indefinite<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">additive</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>sum<span class=\"token punctuation\">\"</span></span>\n<span class=\"token punctuation\">/></span></span></code></pre></div>\n<p style=\"text-align:center;\">\n  <img src=\"/image/rick-animate-additive.svg\" alt=\"animate values attribute demo\">\n</p>\n<p>（註：經實測，animateTransform 在手機上似乎不支援，請用桌面版瀏覽器查看此範例）</p>\n<h2 id=\"結論\" style=\"position:relative;\"><a href=\"#%E7%B5%90%E8%AB%96\" aria-label=\"結論 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>結論</h2>\n<p>今天花了不小的篇幅介紹了 SVG SMIL animation，感謝看到這邊的各位，製作 Demo 的過程對我來說很有趣，也學習了怎麼繪製 SVG，從網路上的其他資源也查到許多詳細的資料，收穫不少！希望對看到這篇文章的你們也能有所啟發，除了常用的 Web animation 與 CSS animation 外，有機會也試試用 SVG 直接作動畫吧！</p>\n<h3 id=\"資料來源\" style=\"position:relative;\"><a href=\"#%E8%B3%87%E6%96%99%E4%BE%86%E6%BA%90\" aria-label=\"資料來源 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>資料來源</h3>\n<ol>\n<li><a href=\"https://www.zhangxinxu.com/wordpress/2014/08/so-powerful-svg-smil-animation/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">超级强大的SVG SMIL animation动画详解</a></li>\n<li><a href=\"https://css-tricks.com/guide-svg-animations-smil/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">A Guide to SVG Animations (SMIL)</a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/SVG/SVG_animation_with_SMIL\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">SVG animation with SMIL</a></li>\n<li><a href=\"http://tutorials.jenkov.com/svg/svg-animation.html#set\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">SVG Animation</a></li>\n</ol>","id":"d92d1023-e99a-574a-8942-b9f6a51ceb0d","fields":{"slug":"svg-smil-animation-intro"},"frontmatter":{"date":"2021-06-18T08:56:40.000Z","title":"讓 SVG 自己動起來！ SVG SMIL Animation 介紹","tags":["web","svg","animation","smil"],"type":"tech","slug":"svg-smil-animation-intro"},"timeToRead":14},{"excerpt":"\"When you look at someone through rose-colored glasses, all the red flags just look like flags.\"","html":"<blockquote>\n<p>\"When you look at someone through rose-colored glasses, all the red flags just look like flags.\"</p>\n</blockquote>\n<!-- more -->\n<h1 id=\"前言\" style=\"position:relative;\"><a href=\"#%E5%89%8D%E8%A8%80\" aria-label=\"前言 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>前言</h1>\n<p>在 Codepen 上常常看到很多會設計又懂寫前端的高手，用 SVG 畫出很漂亮的圖案後，還能讓他們產生可愛的動畫，我一直很好奇他們是怎麼實作的，總覺得很困難，好像得對 SVG 透徹了解，並且自己畫出那些 SVG 圖案，才有辦法實作動畫。\n但其實不然，今天就來分享一個簡單的小技巧，讓你在短短十分鐘內就能讓一個靜態的 SVG 圖案活躍起來！</p>\n<p>簡單看個成品，你可以點選下面範例中的 <code class=\"language-text\">build</code> 按鈕，可以看到原本靜止的 SVG 房子動了起來！</p>\n<p class=\"codepen\" data-height=\"639\" data-theme-id=\"29194\" data-default-tab=\"result\" data-user=\"arvin0731\" data-slug-hash=\"qBBRYjp\" style=\"height: 639px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;\" data-pen-title=\"SVG Animation House\">\n  <span>See the Pen <a href=\"https://codepen.io/arvin0731/pen/qBBRYjp\">\n  SVG Animation House</a> by Arvin (<a href=\"https://codepen.io/arvin0731\">@arvin0731</a>)\n  on <a href=\"https://codepen.io\">CodePen</a>.</span>\n</p>\n<script async src=\"https://static.codepen.io/assets/embed/ei.js\"></script>\n<h2 id=\"第一步先找到你喜歡的-svg-圖案\" style=\"position:relative;\"><a href=\"#%E7%AC%AC%E4%B8%80%E6%AD%A5%E5%85%88%E6%89%BE%E5%88%B0%E4%BD%A0%E5%96%9C%E6%AD%A1%E7%9A%84-svg-%E5%9C%96%E6%A1%88\" aria-label=\"第一步先找到你喜歡的 svg 圖案 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>第一步，先找到你喜歡的 SVG 圖案</h2>\n<p>如果你跟我一樣，畫不出漂亮的圖案或 Icon，可以到 <a href=\"https://www.flaticon.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Flaticon</a>、<a href=\"https://www.iconfinder.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Iconfinder</a> 或 <a href=\"https://icons8.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">icons8</a> 等網站找些免費的 svg icon 下載使用（注意授權即可）。</p>\n<p><img src=\"/image/flaticon-desktop.png\" alt=\"Find a good icon\"></p>\n<p>前陣子到美國出差發現他們好像很流行滑板車（scooter），那就到 <a href=\"https://www.flaticon.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Flaticon</a> 上找個類似的圖案來玩玩！（一開始的房屋範例也是從 <a href=\"https://www.flaticon.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Flaticon</a> 取得的）：</p>\n<div style=\"margin: 0 auto; display: block; width: 256px;\">\n<svg id=\"Capa_1\" enable-background=\"new 0 0 512.004 512.004\" height=\"256\" viewBox=\"0 0 512.004 512.004\" width=\"256\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m175.669 463.803c-8.283 0-15-6.716-15-15 0-53.743-43.723-97.467-97.467-97.467-14.622 0-28.673 3.153-41.762 9.371-7.483 3.555-16.432.371-19.986-7.112-3.555-7.482-.37-16.431 7.113-19.985 17.143-8.143 35.525-12.273 54.635-12.273 70.286 0 127.467 57.182 127.467 127.467 0 8.283-6.714 14.999-15 14.999z\" fill=\"#c5e1e6\"/><path d=\"m442.768 321.476c-63.027 2.945-113.414 51.086-120.563 112.327h-210.801c-8.285 0-15 6.716-15 15s6.715 15 15 15h224.932c8.285 0 15-6.716 15-15 0-52.162 40.777-94.928 92.832-97.36 8.275-.387 14.67-7.408 14.283-15.684-.387-8.275-7.402-14.684-15.683-14.283z\" fill=\"#008adf\"/><path d=\"m442.768 321.476c-63.027 2.945-113.414 51.086-120.563 112.327h-66.204v30h80.335c8.285 0 15-6.716 15-15 0-52.162 40.777-94.928 92.832-97.36 8.275-.387 14.67-7.408 14.283-15.684-.387-8.275-7.402-14.684-15.683-14.283z\" fill=\"#0065a3\"/><path d=\"m448.787 415.604c-7.721 0-14.279-5.923-14.932-13.755l-28.796-345.572c-1.291-15.484-11.852-26.275-20.521-26.275-8.283 0-15-6.716-15-15s6.717-15 15-15c12.9 0 25.295 5.971 34.9 16.811 8.852 9.99 14.361 23.12 15.518 36.972l28.797 345.573c.688 8.256-5.447 15.506-13.703 16.194-.425.035-.847.052-1.263.052z\" fill=\"#8db9c4\"/><circle cx=\"63.203\" cy=\"448.803\" fill=\"#c5e1e6\" r=\"48.2\"/><path d=\"m63.203 512.002c-34.848 0-63.199-28.351-63.199-63.199 0-34.849 28.352-63.199 63.199-63.199 34.85 0 63.201 28.35 63.201 63.199 0 34.848-28.352 63.199-63.201 63.199zm0-96.398c-18.306 0-33.199 14.893-33.199 33.199 0 18.307 14.894 33.199 33.199 33.199 18.307 0 33.201-14.893 33.201-33.199s-14.895-33.199-33.201-33.199z\" fill=\"#1d4659\"/><circle cx=\"448.803\" cy=\"448.803\" fill=\"#8db9c4\" r=\"48.2\"/><g fill=\"#0e232c\"><path d=\"m448.803 512.002c-34.848 0-63.199-28.351-63.199-63.199 0-34.849 28.352-63.199 63.199-63.199 34.85 0 63.201 28.35 63.201 63.199 0 34.848-28.352 63.199-63.201 63.199zm0-96.398c-18.307 0-33.199 14.893-33.199 33.199 0 18.307 14.893 33.199 33.199 33.199 18.307 0 33.201-14.893 33.201-33.199s-14.895-33.199-33.201-33.199z\"/><path d=\"m352.402.002c-8.283 0-15 6.716-15 15s6.717 15 15 15h32.135v-30h-32.135z\"/></g></svg>\nIcons made by <a href=\"https://www.flaticon.com/authors/freepik\" title=\"Freepik\">Freepik</a> from <a href=\"https://www.flaticon.com/\" title=\"Flaticon\">www.flaticon.com</a></div>\n<h2 id=\"第二步分析一下你的-svg-長什麼樣子\" style=\"position:relative;\"><a href=\"#%E7%AC%AC%E4%BA%8C%E6%AD%A5%E5%88%86%E6%9E%90%E4%B8%80%E4%B8%8B%E4%BD%A0%E7%9A%84-svg-%E9%95%B7%E4%BB%80%E9%BA%BC%E6%A8%A3%E5%AD%90\" aria-label=\"第二步分析一下你的 svg 長什麼樣子 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>第二步，分析一下你的 SVG 長什麼樣子</h2>\n<p>找到喜歡的 svg icon 後，用瀏覽器打開，接著開啟 devtool，你會看到下面的結果：</p>\n<p><img src=\"/image/svg-in-browser.png\" alt=\"open svg from browser\"></p>\n<p>裡面的 <code class=\"language-text\">path</code> 跟 <code class=\"language-text\">circle</code> 都是 svg 的 DOM 元件，跟字面上意思一樣，就是 svg 圖案內的線條與圓形。</p>\n<p>svg 的 <code class=\"language-text\">path</code>，基本上就是一連串的 svg mini language：</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>path</span> <span class=\"token attr-name\">d</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>M 10 25\n         L 10 75\n         L 60 75\n         L 10 25<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>上面程式碼中的 d 的內容：M 代表將 筆 移動到 (10, 25)，接著 L 畫一條線到 (10, 75)，以此類推。詳細介紹可看<a href=\"https://www.dashingd3js.com/svg-paths-and-d3js\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">這裡 - SVG Paths and D3.js</a>。</p>\n<p>透過 devtool，我們可以知道每個 <code class=\"language-text\">path</code> 是對應到畫面上的哪個部分：</p>\n<p><img src=\"/image/animate-svg-devtool.gif\" alt=\"devtool-find-parts\"></p>\n<p>到這邊大概就會有個方向了，既然我們可以知道每個元件對應到圖案上的哪個部分，我們就能夠針對想要套上動畫的 DOM 元件來操作！</p>\n<h2 id=\"第三步好用的動畫工具---timelinelite--tweenmax\" style=\"position:relative;\"><a href=\"#%E7%AC%AC%E4%B8%89%E6%AD%A5%E5%A5%BD%E7%94%A8%E7%9A%84%E5%8B%95%E7%95%AB%E5%B7%A5%E5%85%B7---timelinelite--tweenmax\" aria-label=\"第三步好用的動畫工具   timelinelite  tweenmax permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>第三步，好用的動畫工具 - TimelineLite &#x26; TweenMax</h2>\n<p>當然你可以給予每個 svg 內的 DOM 元件一個獨特的 id，或是 class name，然後用 CSS 或 JavaScript 來自行處理動畫，但這樣難度還是頗高，更重要的是，就沒辦法在十分鐘內做完 XD</p>\n<p>所以我們得借用工具，Timeline(Lite|Max) 跟 TweenMax 是知名的 <a href=\"https://greensock.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">GreenSock Animation Platform（簡稱 GSAP）</a>推出的套件，從名稱就可以猜出，主要是提供 <strong>時間軸</strong> 與 <strong>補間</strong> 動畫的 API：</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token comment\">&lt;!-- index.html --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>example<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>example__ball<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>example__title<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Taiwan No.1!<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span>\n  \n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token special-attr\"><span class=\"token attr-name\">onclick</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token value javascript language-javascript\"><span class=\"token function\">animateCircle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">\"</span></span></span><span class=\"token punctuation\">></span></span> Build! <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token comment\">&lt;!-- JavaScript --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n<span class=\"token comment\">// 使用 TimelineMax 物件</span>\n<span class=\"token keyword\">const</span> tl <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TimelineMax</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 利用 .set 設定擁有 class name .example__title 的元素</span>\n<span class=\"token comment\">// 將其 scale 縮小成 0.2，透明度設為 0</span>\ntl\n  <span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".example__title\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    scale<span class=\"token operator\">:</span> <span class=\"token number\">0.2</span><span class=\"token punctuation\">,</span>\n    autoAlpha<span class=\"token operator\">:</span> <span class=\"token number\">0</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// 將擁有 class name .example__ball 的元素</span>\n  <span class=\"token comment\">// scale 縮小成 0.2</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".example__ball\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    scale<span class=\"token operator\">:</span> <span class=\"token number\">0.2</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// tween 1: 在 1 秒內旋轉 360 度，並翻轉 180 度</span>\n  <span class=\"token comment\">// 接著回復 scale 成原始大小，中間以 Elastic.easeIn 這個 ease function 來控制動畫速度</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">to</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".example__ball\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    rotationX<span class=\"token operator\">:</span> <span class=\"token number\">360</span><span class=\"token punctuation\">,</span>\n    rotationY<span class=\"token operator\">:</span> <span class=\"token number\">180</span><span class=\"token punctuation\">,</span>\n    scale<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n    ease<span class=\"token operator\">:</span> Elastic<span class=\"token punctuation\">.</span>easeIn<span class=\"token punctuation\">.</span><span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// tween 2: 跟第一個補間動畫雷同，只是這次是控制文字，並在 0.5 內完成</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">to</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".example__title\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    autoAlpha<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n    scale<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n    ease<span class=\"token operator\">:</span> Back<span class=\"token punctuation\">.</span>easeOut<span class=\"token punctuation\">.</span><span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>GSAP 甚至提供一個 <a href=\"https://greensock.com/ease-visualizer/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Ease Visualizer</a> 讓你可以看看每種 Ease function 的效果，更順帶附上程式碼：</p>\n<p><img src=\"/image/GSAP-ease-visualizer.png\" alt=\"gsap ease visualizer\"></p>\n<p>上述短短的程式碼就能達到如下效果：</p>\n<p class=\"codepen\" data-height=\"447\" data-theme-id=\"29194\" data-default-tab=\"result\" data-user=\"arvin0731\" data-slug-hash=\"pooKOxo\" style=\"height: 447px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;\" data-pen-title=\"GSAP Tutorial: Simple Timeline\">\n  <span>See the Pen <a href=\"https://codepen.io/arvin0731/pen/pooKOxo\">\n  GSAP Tutorial: Simple Timeline</a> by Arvin (<a href=\"https://codepen.io/arvin0731\">@arvin0731</a>)\n  on <a href=\"https://codepen.io\">CodePen</a>.</span>\n</p>\n<script async src=\"https://static.codepen.io/assets/embed/ei.js\"></script>\n<h2 id=\"第四步結合-gsap-工具與你喜愛的-svg\" style=\"position:relative;\"><a href=\"#%E7%AC%AC%E5%9B%9B%E6%AD%A5%E7%B5%90%E5%90%88-gsap-%E5%B7%A5%E5%85%B7%E8%88%87%E4%BD%A0%E5%96%9C%E6%84%9B%E7%9A%84-svg\" aria-label=\"第四步結合 gsap 工具與你喜愛的 svg permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>第四步，結合 GSAP 工具與你喜愛的 SVG</h2>\n<p>GSAP 的 API 文件蠻齊全的，還有論壇可以搜尋相關問題，使用上有任何問題幾乎都能在上面找到答案：<a href=\"https://greensock.com/docs/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">官網文件</a>、<a href=\"https://greensock.com/forums/forum/11-gsap/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">論壇</a></p>\n<p>在一開始的房屋範例中，我主要使用的是 TimelineMax 的 <code class=\"language-text\">from</code> 與 <code class=\"language-text\">staggerFrom</code>，跟前步驟內的範例不同，這兩個 API 只需要設定初始值，他會在指定時間內將補間動畫完成：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">tl<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#House > rect:nth-child(24)'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>scaleX<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> transformOrigin<span class=\"token operator\">:</span> <span class=\"token string\">\"center\"</span><span class=\"token punctuation\">,</span> ease<span class=\"token operator\">:</span> Power2<span class=\"token punctuation\">.</span>easeOut<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>將 CSS Selector <code class=\"language-text\">#House > rect:nth-child(24)</code> 這個元素，從 scaleX 為 0 開始，以 center(中心) 為變形起點，利用 Power2.easeOut 的 ease function，在一秒內回復到原始狀態，並執行補間動畫。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">.</span><span class=\"token function\">staggerFrom</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'#House > path:nth-child(34)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'#House > path:nth-child(32)'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.8</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>scaleY<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> transformOrigin<span class=\"token operator\">:</span> <span class=\"token string\">\"bottom\"</span><span class=\"token punctuation\">,</span> ease<span class=\"token operator\">:</span> Bounce<span class=\"token punctuation\">.</span>easeOut<span class=\"token punctuation\">,</span> stagger<span class=\"token operator\">:</span><span class=\"token number\">0.2</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"scene1+=0.5\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>與 <code class=\"language-text\">from</code> 雷同，只是 <code class=\"language-text\">staggerFrom</code> 可以一次放入多個 CSS Selector，用 <code class=\"language-text\">stagger</code> 這個屬性來設定陣列中的 Selector 要以怎樣的時間差出現。</p>\n<p>詳細 API 參數可以參考<a href=\"https://greensock.com/docs/v2/TimelineMax\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">官方文件</a></p>\n<p>接著回到我們的 SVG，在 devtool 的幫助下，要取出 svg 內部元素的 CSS Selector 非常容易，在 DOM 元件上按右鍵，選擇 <code class=\"language-text\">Copy -> Copy selector</code>，就能直接複製到該元件的 CSS Selector：</p>\n<p><img src=\"/image/svg-animation-copy-selector.png\" alt=\"copy selector directly\"></p>\n<p>現在我們能取得 svg 中任何部分的 CSS Selector，也知道我們能用 GSAP API 來進行補間動畫，現在是時候將其結合起來！</p>\n<p>第一步先調整一下基本 Layout，一般在空白 Html 內直接放入 svg 時，圖案大多會緊靠頁面左上角，因為 svg 本身通常不會有任何關於 layout 的 CSS，所以可以套用個 <code class=\"language-text\">margin: 0 auto</code> 將其置中，看起來會順眼一些，你也能額外加些 padding。此外，為了方便測試動畫效果，也可以放個 button 在頁面上，用來呼叫你的動畫函式：</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token comment\">&lt;!--html part--></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token special-attr\"><span class=\"token attr-name\">onclick</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token value javascript language-javascript\"><span class=\"token function\">animateBike</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">\"</span></span></span><span class=\"token punctuation\">></span></span> Build! <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n<span class=\"token comment\">&lt;!--css part--></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>style</span><span class=\"token punctuation\">></span></span><span class=\"token style\"><span class=\"token language-css\">\n<span class=\"token selector\">#Capa_1</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">margin</span><span class=\"token punctuation\">:</span> 0 auto<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> block<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> 256px<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> 100%<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>style</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>接著我們使用 <code class=\"language-text\">TimelineMax</code> 提供的 <code class=\"language-text\">staggerFrom</code> 函式，利用 devtool 將滑板車的輪子部分找出來，複製它們的 CSS Selector，放入 <code class=\"language-text\">staggerFrom</code> 函式參數中，設定 x 與 y 軸的 <code class=\"language-text\">scale</code> 都從 0 開始，由 <code class=\"language-text\">center</code> 增長，採用 <code class=\"language-text\">Bounce.easeOut</code> 的 ease function，而四個 Selector 間以 <code class=\"language-text\">stagger: 0.2</code> 的屬性值作為補間動畫出現的時間差：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> tl <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TimelineMax</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  tl\n    <span class=\"token punctuation\">.</span><span class=\"token function\">staggerFrom</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'#Capa_1 > g > path:nth-child(1)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'#Capa_1 > circle:nth-child(7)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'#Capa_1 > path:nth-child(6)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'#Capa_1 > circle:nth-child(5)'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>scaleY<span class=\"token operator\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> scaleX<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> transformOrigin<span class=\"token operator\">:</span> <span class=\"token string\">\"center\"</span><span class=\"token punctuation\">,</span> ease<span class=\"token operator\">:</span> Bounce<span class=\"token punctuation\">.</span>easeOut<span class=\"token punctuation\">,</span> stagger<span class=\"token operator\">:</span><span class=\"token number\">0.2</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>簡單幾行程式碼，就能讓我們的滑板車有了動畫！</p>\n<p class=\"codepen\" data-height=\"417\" data-theme-id=\"29194\" data-default-tab=\"js,result\" data-user=\"arvin0731\" data-slug-hash=\"MWWXPVm\" style=\"height: 417px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;\" data-pen-title=\"Scooter - demo1\">\n  <span>See the Pen <a href=\"https://codepen.io/arvin0731/pen/MWWXPVm\">\n  Scooter - demo1</a> by Arvin (<a href=\"https://codepen.io/arvin0731\">@arvin0731</a>)\n  on <a href=\"https://codepen.io\">CodePen</a>.</span>\n</p>\n<script async src=\"https://static.codepen.io/assets/embed/ei.js\"></script>\n<h2 id=\"第五步發揮創意將整體動畫完成\" style=\"position:relative;\"><a href=\"#%E7%AC%AC%E4%BA%94%E6%AD%A5%E7%99%BC%E6%8F%AE%E5%89%B5%E6%84%8F%E5%B0%87%E6%95%B4%E9%AB%94%E5%8B%95%E7%95%AB%E5%AE%8C%E6%88%90\" aria-label=\"第五步發揮創意將整體動畫完成 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>第五步，發揮創意，將整體動畫完成</h2>\n<p>TimelineMax 所提供的 API 都是 chainable 的，你可以想像成是時間軸一般，動畫跟著 chain 一步一步照順序執行，而 <code class=\"language-text\">staggerFrom</code> 則可以同時讓多個 DOM 元件以些微時間差的順序啟動，另外也能設置一些 Flag 來指定要等到哪幾個動畫完成後，才接續其他動畫，這些細節當你在思考要如何“動畫”你的 SVG 時，再去 GSAP 的文件與論壇查詢，相信都能找到解答。</p>\n<p>最後，發揮自己的創意，把 svg 的各個部分都補上動畫，搭配 GSAP 提供的文件，組合各種 API，一個簡單的作品就完成了：</p>\n<p class=\"codepen\" data-height=\"403\" data-theme-id=\"29194\" data-default-tab=\"result\" data-user=\"arvin0731\" data-slug-hash=\"XWWYYWM\" style=\"height: 403px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;\" data-pen-title=\"Scooter - final-steps\">\n  <span>See the Pen <a href=\"https://codepen.io/arvin0731/pen/XWWYYWM\">\n  Scooter - final-steps</a> by Arvin (<a href=\"https://codepen.io/arvin0731\">@arvin0731</a>)\n  on <a href=\"https://codepen.io\">CodePen</a>.</span>\n</p>\n<script async src=\"https://static.codepen.io/assets/embed/ei.js\"></script>\n<h2 id=\"結論\" style=\"position:relative;\"><a href=\"#%E7%B5%90%E8%AB%96\" aria-label=\"結論 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>結論</h2>\n<p>雖然這個小技巧說破真的不值錢，最困難的技術都交給了 GSAP 處理，SVG 還不用是自己畫的，但加在自己的部落格或是放在投影片中，可以瞬間讓畫面更加豐富，無聊沒事拿來娛樂自己也是很不錯的選擇，像是出國旅行回來有時差睡不著，不如就來畫個動畫調養身心 XD\n總之，我自己覺得蠻有趣的，希望或多或少對讀到這篇文章的人有點幫助。</p>\n<h3 id=\"資料來源\" style=\"position:relative;\"><a href=\"#%E8%B3%87%E6%96%99%E4%BE%86%E6%BA%90\" aria-label=\"資料來源 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>資料來源</h3>\n<ol>\n<li><a href=\"https://greensock.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">GreenSock Animation Platform</a></li>\n<li><a href=\"https://medium.com/@LewisMenelaws/how-to-create-beautiful-svg-animations-easily-610eb2690ac3\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">How to Create Beautiful SVG Animations Easily</a></li>\n</ol>","id":"6f9a0e19-cbd4-5930-8fc8-f30f2d7618ad","fields":{"slug":"svg-animation-in-10-mins"},"frontmatter":{"date":"2019-11-06T08:56:40.000Z","title":"十分鐘、五步驟，SVG 動起來！","tags":["web","svg","animation","TimelineMax","GSAP"],"type":"tech","slug":"svg-animation-in-10mins"},"timeToRead":9},{"excerpt":"~ $ What's the funny thing about UDP jokes?\n~ $ I don't care if you get them.","html":"<blockquote>\n<p>~ $ What's the funny thing about UDP jokes?\n~ $ I don't care if you get them.</p>\n</blockquote>\n<!-- more -->\n<h2 id=\"前言\" style=\"position:relative;\"><a href=\"#%E5%89%8D%E8%A8%80\" aria-label=\"前言 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>前言</h2>\n<p>以前在做一些跟地圖有關的應用時，第一個出現在腦海的不外乎是 Google Map 和 OpenStreetMap，然後搭配 Leaflet 與 Mapbox 等工具來對 map tile 做各種加工渲染，然而到了工作上需要時就會發現這些工具在不付費、遵守授權的狀況下，就出現了各種限制，像是需要自己架設 tile server 來轉換 OpenStreetMap 的圖資，或是 request 的次數限制等等。</p>\n<p>想了想發現最好的替代方案就是直接用 svg 來繪製，雖然沒有辦法像 Google Map 那般詳細，但在某些應用上來說就非常足夠，效果也很好，因此今天就來紀錄一下該如何使用 D3.js 與 svg 來繪製出有動態路線功能的地圖，讓大家可以做出類似中央氣象局的颱風路線預覽圖的作品！</p>\n<p>先看一下成品：(P.S. 最近發現 <a href=\"https://codesandbox.io\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">codesandbox</a> 這個服務，比起在 jsbin 或是 jsfiddle 上寫 React 來說好用一些，缺點是 mobile 體驗較差)</p>\n<iframe src=\"https://codesandbox.io/embed/Wv9kBrJW?hidenavigation=1&view=preview\" style=\"width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;\" sandbox=\"allow-modals allow-forms allow-popups allow-scripts allow-same-origin\"></iframe>\n<h2 id=\"地圖資料搜集\" style=\"position:relative;\"><a href=\"#%E5%9C%B0%E5%9C%96%E8%B3%87%E6%96%99%E6%90%9C%E9%9B%86\" aria-label=\"地圖資料搜集 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>地圖資料搜集</h2>\n<p>要自己畫地圖，當然就必須自己準備好圖資，看你想要台灣地圖或是世界地圖，基本上在網路上都能找得到，但是在使用網路資料的時候都需要小心授權條款，以世界地圖為例，目前我看到最能自由運用的就是 <a href=\"http://www.naturalearthdata.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Natural Earth</a> 的資料了，基本上有分三種比例的圖資，1:10m、1:50m 與 1:100m:</p>\n<p><img src=\"/image/naturalearth.png\" alt=\"Natural Earth Dataset\"></p>\n<p>從 Natural Earth 載下來的會是 Vector data，無法直接使用在 D3.js 上，好在 D3.js 的作者 Mike Bostock 製作的另一套工具 <a href=\"ttps://github.com/topojson\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">topojson</a> 中已經有 parse 過後的 TopoJSON 檔案，可以直接透過 <code class=\"language-text\">https://unpkg.com/world-atlas@1/world/110m.json</code> 取得，<code class=\"language-text\">50m</code> 的也有，就換一下後面的檔名即可。</p>\n<p>如果你想要其他 Natural Earth 上的資料，其實也可以修改 <a href=\"https://github.com/topojson/world-atlas\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">world-atlas</a> 裡面的 script 來自己轉換成 TopoJSON，可以參考我 fork 過來修改的這份檔案 <a href=\"https://github.com/ArvinH/world-atlas/blob/master/prepublish-populor-place.sh\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">prepublish-populor-place.sh</a>，用來 parse Natural Earth 上的 popular_place data。</p>\n<h2 id=\"繪製基本的-svg-地圖\" style=\"position:relative;\"><a href=\"#%E7%B9%AA%E8%A3%BD%E5%9F%BA%E6%9C%AC%E7%9A%84-svg-%E5%9C%B0%E5%9C%96\" aria-label=\"繪製基本的 svg 地圖 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>繪製基本的 svg 地圖</h2>\n<p>已經有了資料來源，就可以開始動手將地圖繪製出來了！</p>\n<p>首先，React component 的起手式先準備好：</p>\n<div class=\"gatsby-highlight\" data-language=\"jsworldmap.jsx\"><pre class=\"language-jsworldmap.jsx\"><code class=\"language-jsworldmap.jsx\">import React, { Component } from &#39;react&#39;;\nimport { render } from &#39;react-dom&#39;;\n\nclass WorldMap extends Component {\n  constructor() {\n    super()\n    this.state = {\n      worlddata: [],\n      typhoonPath: [],\n      marker: {},\n      graticule: geoGraticule10(),\n    }\n  }\n  \n  componentDidMount() {\n     fetch(&quot;https://unpkg.com/world-atlas@1/world/50m.json&quot;)\n      .then(response =&gt; {\n        if (response.status !== 200) {\n          console.log(`There was a problem: ${response.status}`)\n          return;\n        }\n        response.json().then(worlddata =&gt; {\n          this.setState({\n            worlddata: feature(worlddata, worlddata.objects.countries).features,\n          });\n        })\n      });\n  }\n\n  render() {\n    return (\n      &lt;svg className=&quot;map-svg&quot; width={ 800 } height={ 600 } viewBox=&quot;0 0 800 600&quot;&gt;\n      &lt;/svg&gt;\n    )\n  }\n}\n\nrender(&lt;WorldMap /&gt;, document.getElementById(&#39;root&#39;));</code></pre></div>\n<p>我在 <code class=\"language-text\">componentDidMount</code> 的時候去抓取地圖資料，接著才 <code class=\"language-text\">setState()</code>，但實際上你的專案可以先把資料存起來，這樣一來在 render 的地方就可以直接先 render 出 svg 地圖，這對於採用 Server-side rendering 的專案來說會方便很多，因為如果全部用 D3.js 的話，會需要先 select 到 DOM object 才能進行繪製，會麻煩一些。</p>\n<h3 id=\"利用-svg-path-繪製世界地圖\" style=\"position:relative;\"><a href=\"#%E5%88%A9%E7%94%A8-svg-path-%E7%B9%AA%E8%A3%BD%E4%B8%96%E7%95%8C%E5%9C%B0%E5%9C%96\" aria-label=\"利用 svg path 繪製世界地圖 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>利用 svg path 繪製世界地圖</h3>\n<p>在 svg 底下 append 一個 group，然後 iterate state 中的世界地圖資料，加上每個區塊的 svg path：</p>\n<div class=\"gatsby-highlight\" data-language=\"jsworld_map_path.js\"><pre class=\"language-jsworld_map_path.js\"><code class=\"language-jsworld_map_path.js\">&lt;g className=&quot;countries&quot;&gt;\n    {\n    this.state.worlddata.map((d,i) =&gt; (\n        &lt;path\n        key={ `path-${ i }` }\n        d={ geoPath().projection(this.projection())(d) }\n        className=&quot;country&quot;\n        fill={ `rgba(219, 163, 43,${ 1 / this.state.worlddata.length * i})` }\n        stroke=&quot;#FFFFFF&quot;\n        strokeWidth={ 0.5 }\n        /&gt;\n    ))\n    }\n&lt;/g&gt;</code></pre></div>\n<p>這邊先看一下我們 state 中的 worlddata 到底是什麼東西：</p>\n<p><img src=\"/image/worldtopojson.png\" alt=\"World Map topojson\"></p>\n<p>這是一個 TopoJSON 的格式，TopoJSON 簡單來說可以當作效能更好的 GeoJSON，詳細介紹可以看 <a href=\"https://github.com/topojson/topojson\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">這裡</a>。Array 裡面的每一個 object 都是 type 為 Feature 的物件，其中的 geometry 包含了實際的地理資訊，可能是一個 Polygon，以及此 Polygon 每個點的座標。</p>\n<p>接著我們需要使用 <code class=\"language-text\">d3-geo</code> 中的 <code class=\"language-text\">geoPath</code>，其中有 <code class=\"language-text\">projection()</code> method 能讓我們把剛剛的座標投影（project）到我們繪製的地圖上。</p>\n<p>投影在地圖的繪製中扮演著極為重要的角色，透過投影，我們才能將真實世界的經緯度映射到我們網頁上小小的 svg 中。</p>\n<p><code class=\"language-text\">d3-geo</code> 中的 <code class=\"language-text\">geoPath.projection()</code> 會回傳一個 function，讓你傳地理資訊進去，接著回傳映射過後的 svg path，基本上就是一連串的 svg mini language，就是下列程式碼中的 <code class=\"language-text\">d</code> 的內容：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">&lt;</span>path d<span class=\"token operator\">=</span>\"<span class=\"token constant\">M</span> <span class=\"token number\">10</span> <span class=\"token number\">25</span>\n         <span class=\"token constant\">L</span> <span class=\"token number\">10</span> <span class=\"token number\">75</span>\n         <span class=\"token constant\">L</span> <span class=\"token number\">60</span> <span class=\"token number\">75</span>\n         <span class=\"token constant\">L</span> <span class=\"token number\">10</span> <span class=\"token number\">25</span>\"</code></pre></div>\n<p>M 代表將 筆 移動到 (10, 25)，接著 L 畫一條線到 (10, 75)，以此類推。詳細介紹可看 <a href=\"https://www.dashingd3js.com/svg-paths-and-d3js\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">這裡</a>。</p>\n<p>當然，你必須傳入一個參數，告訴 <code class=\"language-text\">geoPath.projection()</code> 你想要映射的範圍為何，也就是 <code class=\"language-text\">world_map_path.js</code> 中 <code class=\"language-text\">#L6</code> 所傳入的 <code class=\"language-text\">this.projection()</code>：</p>\n<div class=\"gatsby-highlight\" data-language=\"jsprojection\"><pre class=\"language-jsprojection\"><code class=\"language-jsprojection\">projection() {\n    return geoMercator()\n        .scale(1000)\n        .center([125.9605, 26.6978]);\n}</code></pre></div>\n<p>也是回傳一個 Function，利用到 <code class=\"language-text\">d3-geo</code> 的 <code class=\"language-text\">geoMercator</code>，可以定義好你要映射的 scale 是多大，中心位置在哪。</p>\n<p>最後為了讓每個國家的區塊有明顯區分，我們在 <code class=\"language-text\">fill</code> 的地方，隨機給他不同的顏色，<code class=\"language-text\">fill={ rgba(219, 163, 43,${ 1 / this.state.worlddata.length * i}) }</code></p>\n<p>到這個步驟你已經可以畫出下面這樣的地圖了：</p>\n<iframe src=\"https://codesandbox.io/embed/0RKnYZMAL?hidenavigation=1&view=preview\" style=\"width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;\" sandbox=\"allow-modals allow-forms allow-popups allow-scripts allow-same-origin\"></iframe>\n<h2 id=\"繪製動態路線---資料準備\" style=\"position:relative;\"><a href=\"#%E7%B9%AA%E8%A3%BD%E5%8B%95%E6%85%8B%E8%B7%AF%E7%B7%9A---%E8%B3%87%E6%96%99%E6%BA%96%E5%82%99\" aria-label=\"繪製動態路線   資料準備 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>繪製動態路線 - 資料準備</h2>\n<p>接著進行重頭戲，我們要在地圖上繪製出動態的路徑圖。</p>\n<p>第一個步驟也是先準備好資料，以文章開頭的成品來說，是我修改某年的颱風路徑資料而成的，如果想要串接目前的颱風路徑圖，可以到 <a href=\"http://opendata.cwb.gov.tw/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">氣象資料開放平臺</a> 申請會員，就可以拿到 API Key 去索取資料，格式會是 xml。</p>\n<p>API 範例：<code class=\"language-text\">http://opendata.cwb.gov.tw/opendataapi?dataid=W-C0034-004&amp;authorizationkey={你的 API key}</code>\n其中 <code class=\"language-text\">W-C0034-004</code> 是颱風路徑圖資料的 data id。</p>\n<p>資料中會有三個個主要部分，分別是過去的路徑資料 (past)、現在的位置 (curr) 與 未來預測的位置 (fcst)，簡單的 parser 可以參考我的 <a href=\"https://gist.github.com/ArvinH/66d1f9cedfc96deb956031502362202b\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">gist</a></p>\n<p>出來的結果格式如下，主要包含經緯度座標與颱風半徑：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"pastData\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">\"status\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"past\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"time\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2017-07-02T08:00:00+08:00\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"coordinates\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                <span class=\"token number\">126.8</span><span class=\"token punctuation\">,</span>\n                <span class=\"token number\">20.9</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"radius\"</span><span class=\"token operator\">:</span> <span class=\"token number\">80</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token comment\">// ... 過往資料通常很多</span>\n    <span class=\"token punctuation\">]</span>\n    <span class=\"token string\">\"currData\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">\"status\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"curr\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"time\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2017-07-05T02:00:00+08:00\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"coordinates\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                <span class=\"token number\">142.5</span><span class=\"token punctuation\">,</span>\n                <span class=\"token number\">35.1</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"radius\"</span><span class=\"token operator\">:</span> <span class=\"token number\">120</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"fcstData\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">\"status\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"fcst\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"time\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2017-07-05T14:00:00+08:00\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"coordinates\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                <span class=\"token number\">150.5</span><span class=\"token punctuation\">,</span>\n                <span class=\"token number\">36.7</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"radius\"</span><span class=\"token operator\">:</span> <span class=\"token number\">120</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"繪製動態路線---路徑繪製\" style=\"position:relative;\"><a href=\"#%E7%B9%AA%E8%A3%BD%E5%8B%95%E6%85%8B%E8%B7%AF%E7%B7%9A---%E8%B7%AF%E5%BE%91%E7%B9%AA%E8%A3%BD\" aria-label=\"繪製動態路線   路徑繪製 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>繪製動態路線 - 路徑繪製</h2>\n<p>資料產生後，記得先放到 state 當中：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> pastData<span class=\"token punctuation\">,</span> currData<span class=\"token punctuation\">,</span> fcstData <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./parsedWeatherData.json'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n <span class=\"token comment\">//...</span>\n <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      worlddata<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      typhoonPath<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>pastData<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>currData<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>fcstData<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      marker<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">\"201701\"</span><span class=\"token punctuation\">,</span> coordinates<span class=\"token operator\">:</span> pastData<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>coordinates <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>順便加上一個 marker，用來代表颱風本體，以路徑圖的第一個位置為其座標起始點。</p>\n<p>接著我們另外寫一個 <code class=\"language-text\">renderLine()</code> function 來處理路徑繪製的部分，因為待會還會需要加上動畫效果，會複雜一些：</p>\n<div class=\"gatsby-highlight\" data-language=\"jsrenderline\"><pre class=\"language-jsrenderline\"><code class=\"language-jsrenderline\">renderLine() {\n    // 座標映射\n    const pathCoordinates = [];\n    this.state.typhoonPath.forEach((path, i) =&gt; {\n      pathCoordinates.push({\n        x: this.projection()(path.coordinates)[0],\n        y: this.projection()(path.coordinates)[1]\n      });\n    });\n    \n    // 線段繪製函數\n    const lineFunction = d3Line()\n      .x((d) =&gt; d.x)\n      .y((d) =&gt; d.y)\n      .curve(curveCatmullRom);\n\n    // 增加 svg 元素\n    // add path\n    d3Select(&#39;svg&#39;)\n      .append(&#39;g&#39;)\n      .append(&#39;path&#39;)\n      .attr(&#39;class&#39;, &#39;typhoonPath&#39;)\n      .attr(&#39;d&#39;, lineFunction(pathCoordinates))\n      .attr(&#39;fill&#39;, &#39;none&#39;)\n      .attr(&#39;stroke&#39;, &#39;red&#39;)\n      .attr(&#39;stroke-width&#39;, &#39;5px&#39;);\n\n    // add marker\n    d3Select(&#39;svg&#39;)\n      .append(&#39;g&#39;)\n      .append(&#39;circle&#39;)\n        .attr(&quot;transform&quot;, () =&gt; {\n            const x = this.projection()(this.state.marker.coordinates)[0]\n            const y = this.projection()(this.state.marker.coordinates)[1]\n            return `translate(${x}, ${y})`;\n        })\n        .attr(&#39;r&#39;, 10)\n        .attr(&#39;fill&#39;, &#39;yellow&#39;)\n        .attr(&#39;opacity&#39;, 0.7)\n        .attr(&#39;class&#39;, &#39;typhoonMarker&#39;);\n\n    const linePath = d3SelectAll(&#39;path.typhoonPath&#39;);\n    \n  }</code></pre></div>\n<p>繪製路線的 <code class=\"language-text\">renderLine()</code> 可以拆成三部分來說明：</p>\n<ol>\n<li>座標映射：\n由於我們自己 parse 的路徑資料並非 TopoJSON，而且還區分成不同時間的資料，所以我們先個別將路徑映射好座標點，再串接到一個 Array 中，方便後續繪製。\n我們先前提到的 <code class=\"language-text\">projection()</code> 非常好用，只要傳入一個含有 x, y 經緯度的物件，就能幫我們在設定的 scale 中映射出對應位置：<code class=\"language-text\">this.projection()(path.coordinates)</code>，會回還一個 Array，分別為經度和緯度。</li>\n<li>線段繪製函數：\n在 D3.js 中，attribute 可以傳入 function，這邊我們利用 <code class=\"language-text\">d3-shape</code> 中的 <code class=\"language-text\">line</code>（ code 裡面的 d3Line 是我 import 後的變數名稱)來幫忙將映射後的座標 x, y 轉換成 svg path 的 d value。\n其中 <code class=\"language-text\">curve</code> 是 <code class=\"language-text\">d3-shape.line</code> 的補間函數，簡單來說就是決定線段中，每個 <strong>點</strong> 與 <strong>點</strong> 之間該怎麼 <strong>連接</strong>，看過這個對照應該會比較能了解：\n<a href=\"https://bl.ocks.org/d3noob/ced1b9b18bd8192d2c898884033b5529\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">v4 curve interpolation comparison</a>\n<img src=\"/image/linecurve-comparsion.png\" alt=\"curve interpolation comparison\"></li>\n<li>增加 svg 元素：\n這就是最基本的步驟囉，<code class=\"language-text\">d3-select</code> 出 svg 後，再 append 上我們要的 line path 與 marker，有寫過 D3.js 的勢必不陌生。</li>\n</ol>\n<p>在 <code class=\"language-text\">componentDidMount()</code> 的地方加上 <code class=\"language-text\">renderLine()</code> 函數，就可以看到如下結果：</p>\n<iframe src=\"https://codesandbox.io/embed/ERPYl4q94?hidenavigation=1&view=preview\" style=\"width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;\" sandbox=\"allow-modals allow-forms allow-popups allow-scripts allow-same-origin\"></iframe>\n<h2 id=\"繪製動態路線---加上動態路徑效果\" style=\"position:relative;\"><a href=\"#%E7%B9%AA%E8%A3%BD%E5%8B%95%E6%85%8B%E8%B7%AF%E7%B7%9A---%E5%8A%A0%E4%B8%8A%E5%8B%95%E6%85%8B%E8%B7%AF%E5%BE%91%E6%95%88%E6%9E%9C\" aria-label=\"繪製動態路線   加上動態路徑效果 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>繪製動態路線 - 加上動態路徑效果</h2>\n<p>接著我們要讓這個路徑 <strong>活起來</strong>！</p>\n<p>要讓 svg 線段有動畫般的效果其實很簡單，利用 svg 的 <code class=\"language-text\">stroke-dasharray</code> 這個屬性即可，詳細的實作原理可以看 css-tricks 上的這篇文章 <a href=\"https://css-tricks.com/svg-line-animation-works/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">How SVG Line Animation Works</a>，解釋的非常清楚，只是裡面說的做法是透過 CSS 的 animation，跟我們這邊有些微差異，但是原理是相同的。</p>\n<span style=\"color: red\">\n重點就在於，將原始的 **直線** 轉換為 **虛線**，透過改變該虛線的 **dasharray** 區間，來做出動態的效果。\n</span>\n<p>stroke-dasharray 的參數是 ( dash 的長度, gap 的長度 ))，我們只要固定 gap 的長度為線段長，然後讓 dash 的長度從零慢慢轉換成線段長即可達到動畫效果！</p>\n<p>所以我們加上一個 <code class=\"language-text\">transition</code> 函數：</p>\n<div class=\"gatsby-highlight\" data-language=\"jstransition\"><pre class=\"language-jstransition\"><code class=\"language-jstransition\">transition(linePath) {\n    const self = this;\n    linePath.transition()\n      .duration(15000)\n      .attrTween(&quot;stroke-dasharray&quot;, this.translateFn.bind(this, linePath))\n      .on(&#39;end&#39;, () =&gt; {\n        setTimeout(() =&gt; {\n           d3Select(this).call(self.transition.bind(self, linePath)); // infinite loop\n        }, 1500);\n      });\n}</code></pre></div>\n<p><code class=\"language-text\">linePath</code> 是 <code class=\"language-text\">d3-select</code> 到的路徑 path 元件。透過 <code class=\"language-text\">transition()</code> 與 <code class=\"language-text\">attrTween()</code> 來動態調整 <code class=\"language-text\">stroke-dasharray</code> 的值，並且在最後監聽一個 <code class=\"language-text\">end</code> 事件，也就是當每次動畫結束以後，我們隔個 1.5 秒再重新呼叫一次 <code class=\"language-text\">transition()</code>，進行 loop。</p>\n<p><strong>[Note]</strong>\n這邊要注意的是，<code class=\"language-text\">linePath</code> 雖然是透過 <code class=\"language-text\">d3-select</code> 取得的元件，要呼叫他的 <code class=\"language-text\">transition()</code> 函式的話，會需要額外加入 <code class=\"language-text\">d3-transition</code> 的 lib 才行，他會將 <code class=\"language-text\">transition</code> bind 到元件中：\n<code class=\"language-text\">import { transition as d3Transition } from 'd3-transition';</code></p>\n<p><code class=\"language-text\">attrTween</code> 會將 <code class=\"language-text\">transition</code> 過程中的<strong>時間</strong>當作參數丟進去給它的 <strong>value</strong>，而該 <strong>value</strong> 扮演著處理 <strong>補間動畫</strong> 的角色，是一個 input 為時間的補間函式，我們這邊執行一個<code class=\"language-text\">translateFn()</code>，用來處理我們補間動畫過程中需要做的事情，以及定義補間動畫函式的內容：</p>\n<div class=\"gatsby-highlight\" data-language=\"jstranslatefn\"><pre class=\"language-jstranslatefn\"><code class=\"language-jstranslatefn\">translateFn(linePath) {\n    const self = this;\n    // 回傳 input 為 time 的補間函式\n    return (t) =&gt; {\n        const l = linePath.node().getTotalLength();\n        const p = linePath.node().getPointAtLength(t * l);\n        const marker = d3Select(&#39;.typhoonMarker&#39;);\n        marker.attr(&quot;transform&quot;, `translate(${p.x}, ${p.y})`);\n        marker.style(&quot;transition&quot;, &#39;r 1.5s&#39;);\n        marker.attr(&quot;r&quot;, 10);\n        const interpolate = d3Interpolate(`0,${l}`, `${l},${l}`);\n\n        return interpolate(t);\n    }\n}</code></pre></div>\n<p>如同先前提到的，我們要改變 <code class=\"language-text\">stroke-dasharray</code> 的區間，也就是要讓第一個參數，dash 的長度遞增為線段長，線段長度可以從 <code class=\"language-text\">linePath.node().getTotalLength()</code> 取得，透過 <code class=\"language-text\">d3-interpolate</code> 幫助我們產生一個補間函式 <code class=\"language-text\">interpolate(t)</code>，補完 <code class=\"language-text\">0, 線段長</code> -> <code class=\"language-text\">線段長, 線段長</code> 這段參數的變化，並且回傳出去給 <code class=\"language-text\">attrTween</code>。</p>\n<p><code class=\"language-text\">d3</code> 的文件都顯得蠻詳細的，<a href=\"https://github.com/d3/d3-interpolate#interpolate\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">d3-interpolate</a> 這邊有說明不同的 input type 會採用不同的補間函式來處理，例如字串、時間、數字等等。</p>\n<p>加上了這個 <code class=\"language-text\">tranlsateFn</code> 後，線段就活起來了！</p>\n<iframe src=\"https://codesandbox.io/embed/Q1KBD2WLZ?hidenavigation=1&view=preview\" style=\"width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;\" sandbox=\"allow-modals allow-forms allow-popups allow-scripts allow-same-origin\"></iframe>\n<p>在剛剛的 <code class=\"language-text\">translateFn</code> 中我們其實還做了一件事情，就是讓 Marker 跟著線段移動，透過 <code class=\"language-text\">const p = linePath.node().getPointAtLength(t * l);</code> 取得線段在該時間的 point 位置，並 transform 過去。</p>\n<p>但這樣還不夠，既然是想要有颱風路徑的效果，怎麼可以缺少了暴風半徑的資訊呢？</p>\n<p>記得我們原本 parse 出來的資料中有個 <code class=\"language-text\">radius</code> 的值嗎？我們可以在 <code class=\"language-text\">translateFn</code> 中抓出目前資料的半徑值，然後放到 marker 的 <code class=\"language-text\">r</code> attribute 中：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">self<span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>typhoonPath<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">path</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> pixelLocSource <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span><span class=\"token function\">projection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">.</span>coordinates<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>pixelLocSource<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">const</span> radius <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">distanceCalculate</span><span class=\"token punctuation\">(</span>pixelLocSource<span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">.</span>coordinates<span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">.</span>radius<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          marker<span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"r\"</span><span class=\"token punctuation\">,</span> radius<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>但這邊還有個小問題，資料中，半徑的單位是 km，我要怎麼讓它轉換成 svg 中的距離呢？！我們之前的投影函式 <code class=\"language-text\">projection()</code> 只能接受座標參數，沒辦法直接轉換距離啊！</p>\n<p>別慌張，那我們就先計算出中心點到這段半徑後的座標，在轉換成地圖上的點，接著利用國高中數學計算出距離即可！</p>\n<div class=\"gatsby-highlight\" data-language=\"jsdistancecalculate\"><pre class=\"language-jsdistancecalculate\"><code class=\"language-jsdistancecalculate\">distanceCalculate(pixelLocSource, [longitude, latitude], distance){\t\n    // Latitude: 1 deg = 110.574 km\n    // Longitude: 1 deg = 111.320*cos(latitude) km\n    const lat_diff = distance / 110.574;\n    const lon_distance = 111.320 * Math.cos(latitude * Math.PI / 180);\n    const lon_diff = distance / lon_distance;\n  \n    const E = longitude + Math.abs(lon_diff);\n    const pixelLoc = this.projection()([E, latitude]);\n    // distance calculate\n    return Math.sqrt(Math.pow(pixelLocSource[0] - pixelLoc[0], 2) + Math.pow(pixelLocSource[1] - pixelLoc[1], 2));\n}</code></pre></div>\n<p>取巧的點是，利用已知的經緯度距離來做運算：\nLatitude: 1 deg = 110.574 km\nLongitude: 1 deg = 111.320*cos(latitude) km</p>\n<p><code class=\"language-text\">pixelLocSource</code> 是映射過後的中心點位置，<code class=\"language-text\">[longitude, latitude]</code> 則是中心點的原始經緯度，而 <code class=\"language-text\">distance</code> 就是我們要算的暴風半徑。\n由於我們並不需要算出真正半徑內每個點的經緯度，所以這邊我只抓該緯度上的精度來做投影計算，找出該半徑後的精度，再套用普通的兩點距離公式。</p>\n<p>（其實這是我想出來比較暴力的解法啦，歡迎知道有更簡單更好的方式映射距離的朋友告知我！非常感謝）</p>\n<p>最後的成果（將 scale 調大比較看得出來半徑變化）：</p>\n<iframe src=\"https://codesandbox.io/embed/Xo0gjl6qA?hidenavigation=1&view=preview\" style=\"width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;\" sandbox=\"allow-modals allow-forms allow-popups allow-scripts allow-same-origin\"></iframe>\n<p>結論：</p>\n<p>要讓路徑在地圖上動起來並不困難，而且透過 D3.js 的補間函式也能讓你在補間過程中偷做許多手腳，像是我最一開始的範例中還有多判斷資料的時間，針對不同時間留下颱風半徑範圍圖等等。\n本篇的重點在於如何單純透過 D3.js v4 與 svg 的操作來製作出地圖上的動態線段，其他像是基本的經緯度線段 (graticule) 礙於篇幅關係就不細談，相信大家可以從我最一開始的範例中看出是如何製作的。希望本文能對想用 svg 繪製動態路線圖的讀者有所幫助，若文中有任何錯誤也歡迎指正！</p>\n<h2 id=\"資料來源\" style=\"position:relative;\"><a href=\"#%E8%B3%87%E6%96%99%E4%BE%86%E6%BA%90\" aria-label=\"資料來源 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>資料來源</h2>\n<ol>\n<li><a href=\"http://www.naturalearthdata.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Natural Earth</a></li>\n<li><a href=\"ttps://github.com/topojson\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">topojson</a></li>\n<li><a href=\"https://css-tricks.com/svg-line-animation-works/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">How SVG Line Animation Works</a></li>\n<li><a href=\"https://www.dashingd3js.com/svg-paths-and-d3js\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">SVG Paths and D3.js</a></li>\n<li><a href=\"http://andyshora.com/tweening-shapes-paths-d3-js.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">TWEENING CUSTOM SHAPES AND PATHS IN D3.JS</a></li>\n<li><a href=\"http://www.oxxostudio.tw/articles/201411/svg-d3-02-line.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">SVG D3.js - 繪製線段</a></li>\n<li><a href=\"https://bl.ocks.org/dimitardanailov/6f0a451d4457b9fa7bf6e0dddcd0f468\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">D3.js Path Data Generator Line Example</a></li>\n<li><a href=\"https://bl.ocks.org/d3noob/ced1b9b18bd8192d2c898884033b5529\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">v4 curve interpolation comparison</a></li>\n</ol>","id":"34f3bc2e-5a9a-5c0a-b97b-285e2ed9597d","fields":{"slug":"d-3-workshop-map"},"frontmatter":{"date":"2017-07-21T00:25:01.000Z","title":"D3v4 工作坊 - React + D3 繪製 svg 動態路線地圖","tags":["d3","react","svg","d3v4","data visualization"],"type":"tech","slug":"d3-workshop-map"},"timeToRead":14}],"tagName":"svg","type":"tech"}},"staticQueryHashes":["2123680655"]}